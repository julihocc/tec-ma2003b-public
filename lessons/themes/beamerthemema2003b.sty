% MA2003B Custom Beamer Theme
% Application of Multivariate Methods in Data Science
% Dr. Juliho Castillo - Tec de Monterrey

\mode<presentation>

% Base theme - disable automatic section pages
\usetheme[sectionpage=none]{metropolis}
\usecolortheme{default}
\usefonttheme{structurebold}

% Remove navigation symbols
\setbeamertemplate{navigation symbols}{}

% Number captions
\setbeamertemplate{caption}[numbered]

% Load shared color definitions
\RequirePackage{ma2003b-colors}

% Set theme colors
\setbeamercolor{frametitle}{bg=tecblue, fg=white}
\setbeamercolor{title}{fg=tecblue}
\setbeamercolor{structure}{fg=tecblue}
\setbeamercolor{progress bar}{fg=tecorange}
\setbeamercolor{alerted text}{fg=tecorange}

% Font styling
\setbeamerfont{title}{series=\bfseries, size=\Large}
\setbeamerfont{subtitle}{series=\mdseries, size=\normalsize}
\setbeamerfont{frametitle}{series=\bfseries, size=\large}
\setbeamerfont{framesubtitle}{series=\mdseries, size=\small}
\setbeamerfont{block title}{series=\bfseries}
\setbeamerfont{item}{series=\bfseries}
\setbeamerfont{subitem}{series=\mdseries}
\setbeamerfont{subsubitem}{series=\mdseries}

% Custom title page
\defbeamertemplate*{title page}{ma2003b}[1][]
{
  \vfill
  \begingroup
    \centering
    \begin{beamercolorbox}[sep=8pt,center,#1]{title}
      \usebeamerfont{title}\inserttitle\par%
      \ifx\insertsubtitle\@empty%
      \else%
        \vskip0.25em%
        {\usebeamerfont{subtitle}\usebeamercolor[fg]{subtitle}\insertsubtitle\par}%
      \fi%     
    \end{beamercolorbox}%
    \vskip1em\par
    \begin{beamercolorbox}[sep=8pt,center,#1]{author}
      \usebeamerfont{author}\insertauthor
    \end{beamercolorbox}
    \begin{beamercolorbox}[sep=8pt,center,#1]{institute}
      \usebeamerfont{institute}\insertinstitute
    \end{beamercolorbox}
    \begin{beamercolorbox}[sep=8pt,center,#1]{date}
      \usebeamerfont{date}\insertdate
    \end{beamercolorbox}\vskip0.5em
    {\usebeamercolor[fg]{titlegraphic}\inserttitlegraphic\par}
  \endgroup
  \vfill
  
  % Course identifier footer
  \begin{beamercolorbox}[ht=2.25ex,dp=1ex,center]{author in head/foot}%
    \usebeamerfont{author in head/foot}MA2003B - Application of Multivariate Methods in Data Science
  \end{beamercolorbox}%
}

% Custom frame title format
\setbeamertemplate{frametitle}
{
    \nointerlineskip
    \begin{beamercolorbox}[wd=\paperwidth,ht=2.75ex,dp=1.375ex]{frametitle}
        \hspace*{2ex}\insertframetitle%
    \end{beamercolorbox}
}

% Customize itemize items
\setbeamertemplate{itemize item}[circle]
\setbeamertemplate{itemize subitem}[triangle]
\setbeamertemplate{itemize subsubitem}[square]

% Block environments
\setbeamercolor{block title}{bg=tecblue!20, fg=tecblue}
\setbeamercolor{block body}{bg=tecblue!5}

\setbeamercolor{block title example}{bg=tecgreen!20, fg=tecgreen}
\setbeamercolor{block body example}{bg=tecgreen!5}

\setbeamercolor{block title alerted}{bg=tecorange!20, fg=tecorange}
\setbeamercolor{block body alerted}{bg=tecorange!5}

% Footer with course code and enhanced colors
\setbeamercolor{footline}{bg=tecblue!15, fg=tecblue}
\setbeamercolor{author in head/foot}{bg=tecblue!20, fg=tecblue}
\setbeamercolor{title in head/foot}{bg=tecblue, fg=white}
\setbeamercolor{date in head/foot}{bg=tecblue!20, fg=tecblue}

% Footer fonts
\setbeamerfont{author in head/foot}{series=\mdseries, size=\scriptsize}
\setbeamerfont{title in head/foot}{series=\mdseries, size=\small}
\setbeamerfont{date in head/foot}{series=\mdseries, size=\scriptsize}

\setbeamertemplate{footline}
{
  \leavevmode%
  \hbox{%
  \begin{beamercolorbox}[wd=.333333\paperwidth,ht=2.75ex,dp=1.25ex,center]{author in head/foot}%
    \usebeamerfont{author in head/foot}\insertshortauthor
  \end{beamercolorbox}%
  \begin{beamercolorbox}[wd=.333333\paperwidth,ht=2.75ex,dp=1.25ex,center]{title in head/foot}%
    \usebeamerfont{title in head/foot}MA2003B
  \end{beamercolorbox}%
  \begin{beamercolorbox}[wd=.333333\paperwidth,ht=2.75ex,dp=1.25ex,right]{date in head/foot}%
    \usebeamerfont{date in head/foot}\insertshortdate{}\hspace*{2em}
    \insertframenumber{} / \inserttotalframenumber\hspace*{2ex} 
  \end{beamercolorbox}}%
  \vskip0pt%
}

% Customize table of contents
\setbeamertemplate{section in toc}[sections numbered]
\setbeamertemplate{subsection in toc}[subsections numbered]

% Section page customization with lighter blue background
\setbeamercolor{section title}{fg=white, bg=tecblue}
\setbeamercolor{section title box}{fg=white, bg=tecblue!70}
\setbeamercolor{progress bar in section page}{fg=tecorange}
\setbeamerfont{section title}{series=\bfseries, size=\Huge}

% Custom section page template with high contrast box
\defbeamertemplate*{section page}{ma2003b}[1][]
{
  \centering
  \vfill
  % High contrast box for section title
  \begin{beamercolorbox}[sep=20pt,center,wd=0.9\textwidth,rounded=true,shadow=true]{section title box}
    \usebeamerfont{section title}\textcolor{white}{\MakeUppercase{\insertsectionhead}}\par
  \end{beamercolorbox}
  \vspace{2em}
  % Optional subsection in lighter box
  \ifx\insertsubsectionhead\@empty\else
    \begin{beamercolorbox}[sep=8pt,center,wd=0.7\textwidth,rounded=true]{subsection title}
      \usebeamerfont{subsection title}\insertsubsectionhead
    \end{beamercolorbox}
  \fi
  \vfill
}

% Set section page background to Tec blue
\setbeamercolor{section page}{bg=tecblue}

% Mathematical environments
\setbeamercolor{math text}{fg=tecblue}
\setbeamercolor{math text inlined}{fg=tecblue}

\mode<all>